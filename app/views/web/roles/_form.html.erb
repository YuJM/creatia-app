<%= form_with model: [organization, role], 
              id: "role_form",
              data: { turbo_frame: "_top" },
              class: "space-y-6" do |form| %>

  <% if role.errors.any? %>
    <div class="rounded-md bg-red-50 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">오류가 발생했습니다</h3>
          <div class="mt-2 text-sm text-red-700">
            <ul class="list-disc pl-5 space-y-1">
              <% role.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
    <div class="sm:col-span-4">
      <%= form.label :name, "역할 이름", class: "block text-sm font-medium text-gray-700" %>
      <div class="mt-1">
        <%= form.text_field :name,
                            placeholder: "예: 프로젝트 매니저",
                            class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" %>
      </div>
      <p class="mt-2 text-sm text-gray-500">사용자가 이해하기 쉬운 역할 이름을 입력하세요.</p>
    </div>

    <div class="sm:col-span-4">
      <%= form.label :key, "역할 키", class: "block text-sm font-medium text-gray-700" %>
      <div class="mt-1">
        <%= form.text_field :key,
                            placeholder: "예: project_manager",
                            class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" %>
      </div>
      <p class="mt-2 text-sm text-gray-500">시스템에서 사용할 고유한 키입니다. 소문자, 숫자, 언더스코어만 사용 가능합니다.</p>
    </div>

    <div class="sm:col-span-6">
      <%= form.label :description, "설명", class: "block text-sm font-medium text-gray-700" %>
      <div class="mt-1">
        <%= form.text_area :description,
                           rows: 3,
                           placeholder: "이 역할의 책임과 권한에 대해 설명하세요.",
                           class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" %>
      </div>
    </div>

    <div class="sm:col-span-2">
      <%= form.label :priority, "우선순위", class: "block text-sm font-medium text-gray-700" %>
      <div class="mt-1">
        <%= form.number_field :priority,
                              value: role.priority || 50,
                              min: 0,
                              max: 99,
                              class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" %>
      </div>
      <p class="mt-2 text-sm text-gray-500">높은 숫자가 더 높은 권한을 의미합니다 (0-99).</p>
    </div>

    <div class="sm:col-span-4">
      <div class="flex items-start">
        <div class="flex items-center h-5">
          <%= form.check_box :editable,
                              checked: role.editable.nil? ? true : role.editable,
                              class: "focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded" %>
        </div>
        <div class="ml-3 text-sm">
          <%= form.label :editable, "수정 가능", class: "font-medium text-gray-700" %>
          <p class="text-gray-500">이 역할을 나중에 수정할 수 있도록 허용합니다.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="border-t border-gray-200 pt-6">
    <h4 class="text-lg font-medium text-gray-900 mb-4">권한 설정</h4>
    <%= render Roles::PermissionSelectorComponent.new(
      role: role,
      permissions: available_permissions.values.flatten,
      selected_ids: role.persisted? ? role.permission_ids : []
    ) %>
  </div>

  <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
    <%= link_to "취소",
                web_organization_roles_path(organization),
                class: "bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
    
    <%= form.submit role.persisted? ? "역할 수정" : "역할 생성",
                    class: "inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
  </div>
<% end %>