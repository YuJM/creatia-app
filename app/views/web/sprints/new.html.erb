<%# New Sprint Form %>
<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Page Header Component -->
    <%= render Shared::PageHeaderComponent.new(
      title: "Create New Sprint",
      description: "Set up a time-boxed iteration for focused development",
      back_link: @milestone ? milestone_path(@milestone) : sprints_path,
      back_text: @milestone ? "Back to Milestone" : "Back to Sprints",
      actions: []
    ) %>
    
    <div class="bg-white shadow-lg rounded-lg">
      <%= form_with model: [@milestone, @sprint].compact, 
          url: @milestone ? milestone_sprints_path(@milestone) : sprints_path, 
          local: true, 
          data: { controller: "sprint-form" } do |form| %>
        
        <!-- Basic Information Section -->
        <%= render Shared::FormSectionComponent.new(
          title: "Basic Information",
          description: "Define the sprint name and goal",
          columns: 1
        ) do %>
          <div>
            <%= form.label :name, class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :name, 
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                placeholder: "e.g., Sprint 15, Authentication Sprint, UI Polish Sprint" %>
            <% if @sprint.errors[:name].any? %>
              <p class="mt-1 text-sm text-red-600"><%= @sprint.errors[:name].first %></p>
            <% end %>
          </div>
          
          <div>
            <%= form.label :goal, "Sprint Goal", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :goal, 
                rows: 3,
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                placeholder: "What do you want to achieve in this sprint? Define the main objective and success criteria..." %>
          </div>
          
          <% unless @milestone %>
            <div>
              <%= form.label :milestone_id, "Associated Milestone (Optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :milestone_id, 
                  options_for_select([['No milestone', '']], @sprint.milestone_id),
                  {},
                  class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
            </div>
          <% else %>
            <%= form.hidden_field :milestone_id, value: @milestone.id %>
            <div class="p-3 bg-blue-50 rounded-lg">
              <p class="text-sm text-blue-700">
                <strong>Milestone:</strong> <%= @milestone.title %>
              </p>
            </div>
          <% end %>
        <% end %>
        
        <!-- Timeline Section -->
        <%= render Shared::FormSectionComponent.new(
          title: "Timeline",
          description: "Set the sprint duration",
          columns: 2
        ) do %>
          <div>
            <%= form.label :start_date, class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.date_field :start_date, 
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
          </div>
          
          <div>
            <%= form.label :end_date, class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.date_field :end_date, 
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
          </div>
        <% end %>
        
        <!-- Sprint Planning Section -->
        <%= render Shared::FormSectionComponent.new(
          title: "Sprint Planning",
          description: "Define capacity and velocity targets",
          columns: 2,
          border_bottom: false
        ) do %>
          <div>
            <%= form.label :committed_points, "Committed Story Points", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.number_field :committed_points, 
                min: 0,
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                placeholder: "0" %>
            <p class="mt-1 text-xs text-gray-500">Total story points the team commits to completing</p>
          </div>
          
          <div>
            <%= form.label :planned_velocity, "Planned Velocity", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.number_field :planned_velocity, 
                min: 0,
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                placeholder: "0" %>
            <p class="mt-1 text-xs text-gray-500">Expected velocity based on team capacity</p>
          </div>
        <% end %>
        
        <!-- Status (hidden for new sprints, defaults to planning) -->
        <%= form.hidden_field :status, value: 'planning' %>
        
        <!-- Form Actions -->
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3">
          <%= render Ui::ButtonComponent.new(
            variant: :secondary,
            size: :default,
            tag: :a,
            href: @milestone ? milestone_path(@milestone) : sprints_path
          ) do %>
            Cancel
          <% end %>
          
          <%= render Ui::ButtonComponent.new(
            variant: :primary,
            size: :default,
            tag: :button,
            type: :submit
          ) do %>
            Create Sprint
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>